# Bu workflow'un adÄ±
name: Vavoo Kanal Listesi GÃ¼ncelleyici

on:
  # Her 30 dakikada bir otomatik Ã§alÄ±ÅŸtÄ±rÄ±r
  # (Sunucuyu yormamak iÃ§in 5dk yerine 30dk olarak ayarlandÄ±, deÄŸiÅŸtirebilirsiniz)
  schedule:
    - cron: '*/59 * * * *' 
  
  # GitHub arayÃ¼zÃ¼nden manuel olarak Ã§alÄ±ÅŸtÄ±rmayÄ± saÄŸlar
  workflow_dispatch:

jobs:
  # "build" adÄ±nda bir job (iÅŸ) tanÄ±mlÄ±yoruz
  build:
    # En gÃ¼ncel Ubuntu sanal makinesinde Ã§alÄ±ÅŸacak
    runs-on: ubuntu-latest
    
    # Bu job'un, repository'ye kod yazma (commit atma) izni olduÄŸunu belirtir
    permissions:
      contents: write

    steps:
      # 1. AdÄ±m: Repository'deki kodlarÄ± sanal makineye indirir
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. AdÄ±m: Belirtilen Python sÃ¼rÃ¼mÃ¼nÃ¼ (3.10) kurar
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. AdÄ±m: Gerekli Python kÃ¼tÃ¼phanesini (requests) kurar
      # HatanÄ±zÄ±n Ã§Ã¶zÃ¼mÃ¼ bu adÄ±mdÄ±r
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # 4. AdÄ±m: Vavoo scraper betiÄŸini Ã§alÄ±ÅŸtÄ±rÄ±r
      - name: Run Vavoo Scraper
        run: python vavoo_scraper.py

      # 5. AdÄ±m: OluÅŸturulan dosyayÄ± (vavoo_kanallar.m3u8) repository'ye commit'ler ve push'lar
      - name: Commit and Push changes
        run: |
          # Git iÃ§in bot kimliÄŸini ayarla
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # Sadece bizim oluÅŸturduÄŸumuz dosyayÄ± ekle
          git add vavoo_kanallar.m3u8
          
          # DeÄŸiÅŸiklik olup olmadÄ±ÄŸÄ±nÄ± kontrol et
          if git diff --staged --quiet; then
            echo "DeÄŸiÅŸiklik bulunamadÄ±, commit atÄ±lmÄ±yor."
          else
            # DeÄŸiÅŸiklik varsa commit at ve push'la
            echo "DeÄŸiÅŸiklik bulundu, commit atÄ±lÄ±yor..."
            git commit -m "ğŸ“º Otomatik Vavoo kanal listesi gÃ¼ncellendi"
            git push
          fi
